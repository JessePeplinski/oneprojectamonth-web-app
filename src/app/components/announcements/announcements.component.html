<h1>Announcements</h1>
<h1>{{paramDateService.month}}, {{paramDateService.year}}</h1>
<section class="page-container">
  <div class="wave">
    <svg viewBox="0 0 1440 120" aria-hidden="true">
      <path d="M1440,21.2101911 L1440,120 L0,120 L0,21.2101911 C120,35.0700637 240,42 360,42 C480,42 600,35.0700637 720,21.2101911 C808.32779,12.416393 874.573633,6.87702029 918.737528,4.59207306 C972.491685,1.8109458 1026.24584,0.420382166 1080,0.420382166 C1200,0.420382166 1320,7.35031847 1440,21.2101911 Z"></path>
    </svg>
  </div>

  <div class="test-read-write">

    <!-- READ -->

    <p>You should display my user account level here! If I'm an ADMIN, i should be able to create, update, and delete.</p>
    <p>If I'm a USER, I should be able to READ.</p>

    <p-toast position="top-center" key="createAnnouncementToastAlert"></p-toast>
    <p-toast position="top-center" key="updateAnnouncementToastAlert"></p-toast>
    <p-toast position="top-center" key="deleteAnnouncementToastAlert"></p-toast>
    <p-toast position="top-center" key="rejectDeleteAnnouncementToastAlert"></p-toast>

    <div class="text" *ngFor="let announcement of announcements$ | async">
      <div *ngIf="(announcement.isVisible)">


        <!-- TODO: Delete these fields -->
        <!-- <div *ngIf="(announcement.dateCreated.toDate() | date : 'MMMM' == paramDate.month | titlecase)">
          true!
        </div>

        <div *ngIf="(announcement.dateCreated.toDate() | date : 'y' == paramDate.year)">
          true!
        </div> -->

      
        <!-- announcement month: {{announcementDate.month}}
        announcement year: {{announcementDate.year}} -->

        <!-- <p>observable and pipe {{announcement.dateCreated.toDate() | date : 'MMMM'}}</p>
        <p>observable and pipe {{announcement.dateCreated.toDate() | date : 'y'}}</p>

        <p>Date parmams month: {{paramDate.month | titlecase }}</p>
        <p>Date parmams year: {{paramDate.year}}</p>

        <p>announcement month: {{announcementDate.month}}</p>
        <p>announcement year: {{announcementDate.year}}</p> -->

        <div *ngIf="authService.user$ | async as user">
        <div *ngIf="canRead(user)">
          <a [routerLink]="['/hackathons', paramDateService.month, paramDateService.year, 'announcements', announcement.id, announcement.title]"><h2>{{announcement.title}}</h2></a>
          <h2>{{announcement.content}}</h2>
          <h2>Created On: {{announcement.dateCreated.toDate() | date: 'medium'}}</h2>
          <h2 *ngIf="announcement.updatedOn">Last Updated: {{announcement.updatedOn?.toDate() | date: 'medium'}}</h2>
          <button (click)="editAnnouncement($event, announcement)" *ngIf="canEdit(user)">EDIT ANNOUNCEMENT</button>
        </div>
        <button *ngIf="editState && announcementToEdit.id == announcement.id" (click)="clearState()">CLOSE ANNOUNCEMENT</button>

        <div *ngIf="editState && announcementToEdit.id == announcement.id">
          <!-- UPDATE -->

          <form (ngSubmit)="updateAnnouncement(announcement)">
            <input type="text" placeholder="Add title" [(ngModel)]="announcement.title" name="title">
            <input type="text" placeholder="Add content" [(ngModel)]="announcement.content" name="content">
            <button type="submit" value="Update Announcement">Update Announcement</button>
          </form>

          <!-- DELETE -->

          <p-confirmDialog></p-confirmDialog>

          <!-- ADd pButton icon="pi pi-times" back to this class-->
          <button type="button" (click)="deleteAnnouncement($event, announcement);" value="Delete Announcement">Delete
            Announcement</button>

        </div>

        <!-- <router-outlet></router-outlet> -->

      </div>
    </div>

  </div>

  <!-- CREATE -->
  <form (ngSubmit)="createAnnouncementInCollection()">
    <input type="text" placeholder="Add title" [(ngModel)]="announcement.title" name="title">
    <input type="text" placeholder="Add content" [(ngModel)]="announcement.content" name="title">
    <button type="submit" value="Add Announcement">Add Announcement</button>
  </form>
  </div> <!-- END OF AUTH CHECK-->
</section>
